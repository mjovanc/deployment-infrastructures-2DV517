---
  - name: Create instances
    hosts: localhost
    roles:
      - role: instance_private_openstack_create
        vars:
          instance_name: wordpress1
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_auto_ip: no
          instance_security_groups: default,SSH,HTTP,Monitor
      - role: instance_private_openstack_create
        vars:
          instance_name: wordpress2
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_auto_ip: no
          instance_security_groups: default,SSH,HTTP,Monitor
      - role: instance_private_openstack_create
        vars:
          instance_name: mysqlmaster
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_auto_ip: no
          instance_security_groups: default,SSH,MySQL,Monitor
      - role: instance_private_openstack_create
        vars:
          instance_name: mysqlslave
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_auto_ip: no
          instance_security_groups: default,SSH,MySQL,Monitor
      - role: instance_private_openstack_create
        vars:
          instance_name: nginx_wpuploads
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_auto_ip: no
          instance_security_groups: default,SSH,HTTP,Monitor
      - role: instance_private_openstack_create
        vars:
          instance_name: nginx
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_auto_ip: yes
          instance_security_groups: default,SSH,HTTP,Monitor
      - role: instance_private_openstack_create
        vars:
          instance_name: prometheus
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_auto_ip: yes
          instance_security_groups: default,SSH,HTTP,Grafana,Monitor
      - role: openstack_attach_volume
        vars: 
          volume_name: WP_MYSQL_1
          instance_name: mysqlmaster
    tasks:
    - name: Wait for SSH
      pause:
        seconds: 60

#  - name: Install node exporter
#    hosts: wordpress1:wordpress2:mysqlmaster:mysqlslave:nginx
#    roles:
#      - role: monitor_node_exporter_setup
#
#  - name: Install Prometheus and Grafana
#    hosts: prometheus
#    roles:
#      - monitor_prometheus_setup
#      - monitor_grafana_setup
#
#  - name: Install nginx fileserver
#    hosts: nginx_wpuploads
#    roles:
#     - nginx_wpuploads_install
#     
#  - name: Common configuration for all hosts
#    hosts: wordpress:mysql
#    become: yes
#    roles:
#      - common
#
#  - name: Configure MySQL master database
#    hosts: mysqlmaster
#    become: yes
#    roles:
#      - mysql_master_install
#
#  - name: Configure MySQL slave database
#    hosts: mysqlslave
#    become: yes
#    roles:
#      - mysql_slave_install

  - name: Configure Wordpress configurations on master database
    hosts: mysqlmaster
    become: yes
    roles:
      - wordpress_database_setup
#
#  - name: Configure Wordpress frontend
#    hosts: wordpress1:wordpress2
#    become: yes
#    roles:
#      - wordpress_install
#  
#  - name: Install nginx loadbalancer
#    hosts: nginx
#    roles:
#      - nginx_load_balancer_install
#