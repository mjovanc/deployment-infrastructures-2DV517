---
  - name: Create instances
    hosts: localhost
    roles:
      - role: openstack_wordpress_create_instance
      - role: openstack_mysql_create_instances
      - role: openstack_nginx_create_instance
      - role: openstack_attach_volume
        vars: 
          volume_name: WP_MYSQL
          instance_name: mysqlmaster

    tasks:
    - name: Wait for SSH
      pause:
        seconds: 60

#  - name: Common configuration for all hosts
#    hosts: wordpress:mysql
#    become: yes
#
#    roles:
#      - common

  - name: Configure MySQL master database
    hosts: mysqlmaster
    become: yes
    roles:
        - mysql_master

  - name: Configure MySQL slave database
    hosts: mysqlslave
    become: yes
    roles:
        - mysql_slave

  - name: Configure Wordpress configurations on master database
    hosts: mysqlmaster
    become: yes
    roles:
        - wp_db

  - name: Configure Wordpress frontend
    hosts: wordpress1:wordpress2
    become: yes
    roles:
      - wp_frontend
  
  - name: Install nginx loadbalancer
    hosts: nginx
    roles:
      - openstack_nginx_install
