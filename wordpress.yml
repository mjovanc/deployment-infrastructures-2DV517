---
  - name: Create instances
    hosts: localhost
    roles:
      - role: instance_private_openstack_create
        vars:
          instance_name: wordpress1
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_security_groups: default,SSH,HTTP
      - role: instance_private_openstack_create
        vars:
          instance_name: wordpress2
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_security_groups: default,SSH,HTTP
      - role: instance_private_openstack_create
        vars:
          instance_name: mysqlmaster
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_security_groups: default,SSH,MySQL
      - role: instance_private_openstack_create
        vars:
          instance_name: mysqlslave
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_security_groups: default,SSH,MySQL
      - role: instance_private_openstack_create
        vars:
          instance_name: nginx
          instance_flavor: c1-r1-d10
          instance_key_name: ansible_key
          instance_security_groups: default,SSH,HTTP
      - role: openstack_attach_volume
        vars: 
          volume_name: WP_MYSQL
          instance_name: mysqlmaster

    tasks:
    - name: Wait for SSH
      pause:
        seconds: 60

  - name: Install node exporter
    hosts: wordpress1:wordpress2:mysqlmaster:mysqlslave:nginx
    roles:
      - role: monitor_node_exporter_setup

#  - name: Common configuration for all hosts
#    hosts: wordpress:mysql
#    become: yes
#
#    roles:
#      - common

#  - name: Configure MySQL master database
#    hosts: mysqlmaster
#    become: yes
#    roles:
#        - mysql_master
#
#  - name: Configure MySQL slave database
#    hosts: mysqlslave
#    become: yes
#    roles:
#        - mysql_slave
#
#  - name: Configure Wordpress configurations on master database
#    hosts: mysqlmaster
#    become: yes
#    roles:
#        - wp_db
#
#  - name: Configure Wordpress frontend
#    hosts: wordpress1:wordpress2
#    become: yes
#    roles:
#      - wp_frontend
#  
#  - name: Install nginx loadbalancer
#    hosts: nginx
#    roles:
#      - openstack_nginx_install
#